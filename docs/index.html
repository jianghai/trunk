<!DOCTYPE html><html><head><title></title><link rel="stylesheet" href="/trunk/public/icon/iconfont.css"><link rel="stylesheet" href="/trunk/public/stylesheets/common.css"></head><body><div id="wrapper" class="flex"><header><div class="center flex"><div class="flex-1 flex"><h2><a id="logo" href="/trunk/">TRUNK.JS</a></h2><ul id="nav" class="flex-1"><li><a href="/trunk/tutorial">Tutorial</a></li><li class="active"><a href="/trunk/docs">API Reference</a></li><li><a href="/trunk/components">Components</a></li></ul></div><ul class="links"><li><a href="https://github.com/jianghai/trunk">GitHub</a></li></ul></div></header><main class="center flex flex-1"><div class="sidebar"><ul id="apiList"><li><a href="#Trunk.Collection">Trunk.Collection</a><ul><li><a href="#Trunk.Collection-list">- list</a></li><li><a href="#Trunk.Collection-init">- init</a></li><li><a href="#Trunk.Collection-parse">- parse</a></li><li><a href="#Trunk.Collection-length">- length</a></li><li><a href="#Trunk.Collection-add">- add</a></li><li><a href="#Trunk.Collection-remove">- remove</a></li><li><a href="#Trunk.Collection-toArray">- toArray</a></li></ul></li><li><a href="#Trunk.Model">Trunk.Model</a><ul><li><a href="#Trunk.Model-init">- init</a></li><li><a href="#Trunk.Model-parse">- parse</a></li><li><a href="#Trunk.Model-set">- set</a></li><li><a href="#Trunk.Model-reset">- reset</a></li><li><a href="#Trunk.Model-remove">- remove</a></li><li><a href="#Trunk.Model-after">- after</a></li><li><a href="#Trunk.Model-index">- index</a></li><li><a href="#Trunk.Model-prev">- prev</a></li><li><a href="#Trunk.Model-next">- next</a></li></ul></li><li><a href="#Trunk">Trunk</a><ul><li><a href="#Trunk-model">- model</a></li><li><a href="#Trunk-el">- el</a></li><li><a href="#Trunk-tag">- tag</a></li><li><a href="#Trunk-className">- className</a></li><li><a href="#Trunk-init">- init</a></li><li><a href="#Trunk-$">- $</a></li><li><a href="#Trunk-render">- render</a></li><li><a href="#Trunk-renderer">- renderer</a></li><li><a href="#Trunk-template">- template</a></li><li><a href="#Trunk-setElement">- setElement</a></li><li><a href="#Trunk-remove">- remove</a></li><li><a href="#Trunk-delegateEvents">- delegateEvents</a></li><li><a href="#Trunk-events">- events</a></li></ul></li><li><a href="#ajax">ajax</a><ul><li><a href="#ajax-setParam">- setParam</a></li><li><a href="#ajax-param">- param</a></li><li><a href="#ajax-fetch">- fetch</a></li><li><a href="#ajax-url">- url</a></li></ul></li><li><a href="#events">events</a><ul><li><a href="#events-on">- on</a></li><li><a href="#events-once">- once</a></li><li><a href="#events-off">- off</a></li><li><a href="#events-listen">- listen</a></li><li><a href="#events-listenOnce">- listenOnce</a></li><li><a href="#events-trigger">- trigger</a></li></ul></li><li><a href="#extend">extend</a><ul></ul></li><li><a href="#Trunk.template">Trunk.template</a><ul><li><a href="#Trunk.template-global">- global</a></li><li><a href="#Trunk.template-leftTag">- leftTag</a></li><li><a href="#Trunk.template-rightTag">- rightTag</a></li></ul></li></ul></div><div class="content flex-1"><section id="Trunk.Collection"><h1>Trunk.Collection( [attributes] )</h1><table><tr><td class="name">[attributes]</td><td><code class="type">Object</code></td><td class="desc">实例属性</td><td><em class="optional"></em></td></tr></table><p>模型集合</p><pre><span class="kwd">var</span> collection <span class="opt">=</span> <span class="kwd">new</span> Trunk.Collection({<br>  <span class="com">// 集合的模型，默认为Trunk.Model</span><br>  Model: Trunk.Model.extend({<br>    prop: <span class="num">1</span><br>  })<br>})</pre><p></p><h2 id="Trunk.Collection-list">list</h2><p><code>Array</code></p><p>模型集合数组</p><h2 id="Trunk.Collection-init">init</h2><p>构造函数执行完毕前的接口，继承时不会覆盖父类的操作，定义Trunk.Collection.prototype.init则对所有collection有效</p><h2 id="Trunk.Collection-parse">parse( data )</h2><table><tr><td class="name">data</td><td><code class="type">Object | Array</code></td><td class="desc">集合fetch后的数据</td><td><em class="optional"></em></td></tr></table><p>fetch后的数据到add前的转换，重写parse即可定义自己的转换逻辑</p><pre><span class="kwd">var</span> collection <span class="opt">=</span> <span class="kwd">new</span> Trunk.Collection({<br>  url: <span class="str">'test.json'</span> <span class="com">// {stores: [{id: 1}, {id: 2}, {id: 3}]}</span><br>  parse: <span class="kwd">function</span>(data) {<br>    <span class="kwd">return</span> data.stores<br>  }<br>})</pre><p></p><h2 id="Trunk.Collection-length">length</h2><table><tr><td> <b>return </b></td><td><code class="type">Number</code></td><td class="desc"></td></tr></table><p>获取集合模型的数量</p><h2 id="Trunk.Collection-add">add( data )</h2><table><tr><td class="name">data</td><td><code class="type">Array | Object</code></td><td class="desc"></td><td><em class="optional"></em></td></tr></table><p>往集合中添加数据，如果是数组则添加多条，每条数据创建一个模型，所以单条数据类型必须为Object， 否则当成数组遍历成多个模型</p><h2 id="Trunk.Collection-remove">remove( [model | models] )</h2><table><tr><td class="name">[model | models]</td><td><code class="type">Model | Array</code></td><td class="desc"></td><td><em class="optional"></em></td></tr></table><p>从集合中删除模型，支持多个模型</p><h2 id="Trunk.Collection-toArray">toArray</h2><table><tr><td> <b>return </b></td><td><code class="type">Array</code></td><td class="desc"></td></tr></table><p>集合转换成数组，各个数组元素即各个模型的data属性值</p></section><section id="Trunk.Model"><h1>Trunk.Model( [attributes] )</h1><table><tr><td class="name">[attributes]</td><td><code class="type">Object</code></td><td class="desc">实例属性</td><td><em class="optional"></em></td></tr></table><p>模型类，主要进行数据处理，创建view时会自动创建model</p><pre><span class="kwd">var</span> model <span class="opt">=</span> <span class="kwd">new</span> Trunk.Model({<br>  url: <span class="str">'test.json'</span><br>})<br><span class="kwd">var</span> view <span class="opt">=</span> <span class="kwd">new</span> Trunk({<br>  model: model<br>})<br><span class="com">// 推荐方式</span><br><span class="kwd">var</span> view <span class="opt">=</span> <span class="kwd">new</span> Trunk({<br>  model: {<br>    url: <span class="str">'test.json'</span><br>  }<br>})</pre><p></p><h2 id="Trunk.Model-init">init</h2><p>构造函数执行完毕前的接口，继承时不会覆盖父类的操作，定义Trunk.Model.prototype.init则对所有model有效</p><h2 id="Trunk.Model-parse">parse( data )</h2><table><tr><td class="name">data</td><td><code class="type">Object | Array</code></td><td class="desc">传入reset的数据</td><td><em class="optional"></em></td></tr></table><p>数据到模版的转换，重写parse即可定义自己的转换逻辑</p><pre><span class="tag">&lt;div</span> <span class="attr">id=</span><span class="str">"demo"</span><span class="tag">></span><br>  <span class="tag">&lt;script</span> <span class="attr">type=</span><span class="str">"text"</span><span class="tag">></span><br>    <# data.stores.forEach(function(store) { #<span class="tag">></span><br>      <span class="tag">&lt;div</span><span class="tag">></span><#- store.name  #<span class="tag">></span><span class="tag">&lt;/div</span><span class="tag">></span><br>    <# }) #<span class="tag">></span><br>  <span class="tag">&lt;/script</span><span class="tag">></span><br><span class="tag">&lt;/div</span><span class="tag">></span></pre><p></p><pre><span class="kwd">var</span> demo <span class="opt">=</span> <span class="kwd">new</span> Trunk({<br>  model: {<br>    parse: <span class="kwd">function</span>(data) {<br>      <span class="kwd">return</span> {<br>        stores: data<br>      }<br>    }<br>  },<br>  el: <span class="str">'#demo'</span>,<br>  template: <span class="str">'script'</span><br>})<br>demo.model.reset([{name: <span class="str">'1'</span>}, {name: <span class="str">'2'</span>}])</pre><p></p><h2 id="Trunk.Model-set">set( data | key, [options] | value, [options] )</h2><table><tr><td class="name">data | key</td><td><code class="type">Object | String</code></td><td class="desc">数据json或数据字段名</td><td><em class="optional"></em></td></tr><tr><td class="name">[options] | value</td><td><code class="type">Object | *</code></td><td class="desc">配置项（safe/silent）或数据字段值</td><td><em class="optional"></em></td></tr><tr><td class="name">[options]</td><td><code class="type">Object</code></td><td class="desc"></td><td><em class="optional"></em></td></tr><tr><td> <b>return </b></td><td><code class="type">Boolean</code></td><td class="desc">默认返回true，如果存在validate且验证不通过，则返回false</td></tr></table><p>设置模型数据</p><pre><span class="com">// 单个</span><br>model.set(<span class="str">'country'</span>, <span class="str">'China'</span>)<br><span class="com">// 多个</span><br>model.set({<br>  country: <span class="str">'China'</span><br>  <span class="com">// ...</span><br>})<br><span class="com">// 配置</span><br>model.set({<br>  country: <span class="str">'China'</span><br>}, {<br>  safe: <span class="kc">true</span>, <span class="com">// 安全模式，存在validata方法但不进行数据验证（数据验证需要手动定义validate方法，返回布尔值）</span><br>  silent: <span class="kc">true</span> <span class="com">// 静默模式，不触发change事件</span><br>})</pre><p></p><h2 id="Trunk.Model-reset">reset( [data] )</h2><table><tr><td class="name">[data]</td><td><code class="type">Object | Array</code></td><td class="desc"></td><td><em class="optional"></em></td></tr></table><p>重置数据，触发reset事件并渲染视图</p><h2 id="Trunk.Model-remove">remove</h2><p>删除模型并从集合中去除</p><h2 id="Trunk.Model-after">after( [data] )</h2><table><tr><td class="name">[data]</td><td><code class="type">Object | Array</code></td><td class="desc">新模型的数据</td><td><em class="optional"></em></td></tr></table><p>在当前模型后追加一个模型</p><h2 id="Trunk.Model-index">index</h2><table><tr><td> <b>return </b></td><td><code class="type">Number</code></td><td class="desc">索引值</td></tr></table><p>获取当前模型在集合中的索引</p><h2 id="Trunk.Model-prev">prev</h2><table><tr><td> <b>return </b></td><td><code class="type">Model</code></td><td class="desc"></td></tr></table><p>获取当前模型的前一个模型</p><h2 id="Trunk.Model-next">next</h2><table><tr><td> <b>return </b></td><td><code class="type">Model</code></td><td class="desc"></td></tr></table><p>获取当前模型的后一个模型</p></section><section id="Trunk"><h1>Trunk( [attributes] )</h1><table><tr><td class="name">[attributes]</td><td><code class="type">Object</code></td><td class="desc">实例属性</td><td><em class="optional"></em></td></tr></table><p>视图类，提供基础的视图操作，直接处理和反馈用户的操作</p><pre><span class="kwd">var</span> view <span class="opt">=</span> <span class="kwd">new</span> Trunk({<br>  el: <span class="str">'body'</span><br>})</pre><p></p><h2 id="Trunk-model">model</h2><p><code>Object|Model</code></p><p>当前视图的模型属性或模型</p><pre><span class="com">// 实例化后app.model变成Model类的一个实例</span><br><span class="kwd">var</span> app <span class="opt">=</span> <span class="kwd">new</span> Trunk({<br>  model: {<br>    init: <span class="kwd">function</span>() {}<br>  }<br>})<br><span class="com">// 本身就是模型的实例</span><br><span class="kwd">var</span> app <span class="opt">=</span> <span class="kwd">new</span> Trunk({<br>  model: <span class="kwd">new</span> Trunk.Model({<br>    init: <span class="kwd">function</span>() {}<br>  })<br>})</pre><p></p><h2 id="Trunk-el">el</h2><p><code>jQuery|String</code></p><p>视图的DOM容器，支持jQuery对象或选择器</p><h2 id="Trunk-tag">tag</h2><p><code>String</code></p><p>视图的DOM容器HTML标签名称，实例化后会创建对应的jQuery对象</p><h2 id="Trunk-className">className</h2><p><code>String</code></p><p>容器的className</p><h2 id="Trunk-init">init</h2><p>构造函数执行完毕前的接口，继承时不会覆盖父类的操作，定义Trunk.prototype.init则对所有view有效</p><pre><span class="kwd">var</span> view <span class="opt">=</span> <span class="kwd">new</span> Trunk({<br>  init: <span class="kwd">function</span>() {<br>    <span class="kwd">this</span>.model.fetch()<br>  }<br>})</pre><p></p><h2 id="Trunk-$">$( selector )</h2><table><tr><td class="name">selector</td><td><code class="type">String</code></td><td class="desc">选择器</td><td><em class="optional"></em></td></tr><tr><td> <b>return </b></td><td><code class="type">jQuery</code></td><td class="desc">jQuery</td></tr></table><p>在当前view容器下查询子元素，与this.el.find等效</p><h2 id="Trunk-render">render</h2><table><tr><td> <b>return </b></td><td><code class="type">jQuery</code></td><td class="desc">this.el</td></tr></table><p>渲染模版，注入到容器中，model的reset事件触发后自动渲染，手动渲染前确保数据已经准备好</p><h2 id="Trunk-renderer">renderer</h2><p>渲染核心处理方式，默认为模版渲染，如果采用其他非模版的方式（d3等），则需要重写</p><pre><span class="kwd">var</span> view <span class="opt">=</span> <span class="kwd">new</span> Trunk({<br>  renderer: <span class="kwd">function</span>() {<br>    d3.select(<span class="kwd">this</span>.el[<span class="num">0</span>]).append(<span class="str">'svg'</span>)<br>  }<br>})</pre><p></p><h2 id="Trunk-template">template</h2><p><code>String</code></p><p>模版选择器，如果不是ID选择器，则从当前容器中查找（确保容器存在于DOM中）</p><pre><span class="kwd">var</span> list <span class="opt">=</span> <span class="kwd">new</span> Trunk({<br>  el: <span class="str">'#list'</span>, <span class="com">// DOM中已存在</span><br>  template: <span class="str">'.template-list'</span> <span class="com">// 从list元素中查找</span><br>})</pre><p>ID选择器则从整个DOM中查找，容器是否存在不受影响</p><pre><span class="kwd">var</span> Item <span class="opt">=</span> Trunk.extend({<br>  tag: <span class="str">'li'</span>, <span class="com">// 创建的元素，DOM中不存在</span><br>  template: <span class="str">'#template-item'</span><br>})</pre><p></p><h2 id="Trunk-setElement">setElement( el )</h2><table><tr><td class="name">el</td><td><code class="type">jQuery</code></td><td class="desc">容器DOM对象</td><td><em class="optional"></em></td></tr></table><p>设置view容器，一般用于实例化的时候容器不存在DOM中，等容器存在后再绑定到view</p><h2 id="Trunk-remove">remove</h2><p>删除视图以及model</p><h2 id="Trunk-delegateEvents">delegateEvents</h2><p>绑定事件（this.events）到当前容器，采用事件委托方式</p><h2 id="Trunk-events">events</h2><p><code>Object</code></p><p>DOM事件map，用法：'name selector': 'handle'，未指定el或tag属性则不会绑定事件</p><pre><span class="kwd">var</span> view <span class="opt">=</span> <span class="kwd">new</span> Trunk({<br>  events: {<br>    <span class="str">'click'</span>: <span class="str">'onClick'</span>,<br>    <span class="str">'change select'</span>: <span class="str">'onSelectChange'</span><br>  },<br>  onClick: <span class="kwd">function</span>() {},<br>  onSelectChange: <span class="kwd">function</span>() {}<br>})</pre><p></p></section><section id="ajax"><h1>ajax</h1><p>ajax请求交互模块，服务端返回的数据格式必须是JSON， Trunk、Trunk.Model、Trunk.Collection的实例均可调用</p><h2 id="ajax-setParam">setParam( param | key, [silent] | value, [silent] )</h2><table><tr><td class="name">param | key</td><td><code class="type">Object | String</code></td><td class="desc">请求参数对象或参数名</td><td><em class="optional"></em></td></tr><tr><td class="name">[silent] | value</td><td><code class="type">Boolean | *</code></td><td class="desc">静默模式（默认设置完参数后fetch数据）或参数值</td><td><em class="optional"></em></td></tr><tr><td class="name">[silent]</td><td><code class="type">Boolean</code></td><td class="desc"></td><td><em class="optional"></em></td></tr></table><p>设置GET请求参数，如果参数值为空字符串或null或undefined，则删除当前参数</p><pre>model.setParam({<br>  sort: <span class="str">'id'</span>,<br>  sortType: <span class="kc">null</span> <span class="com">// 删除当前字段</span><br>})</pre><p></p><h2 id="ajax-param">param</h2><p><code>Object</code></p><p>fetch数据的请求参数对象</p><h2 id="ajax-fetch">fetch</h2><p>发送ajax请求，向服务器fetch数据（GET请求）</p><h2 id="ajax-url">url</h2><p><code>String</code></p><p>fetch数据的URL</p></section><section id="events"><h1>events</h1><p><code>[type]</code></p><p>事件模型，提供事件注册和触发的观察机制，Trunk、Trunk.Model、Trunk.Collection的实例均可调用</p><h2 id="events-on">on( name, handle, [context] )</h2><table><tr><td class="name">name</td><td><code class="type">String</code></td><td class="desc">事件名称</td><td><em class="optional"></em></td></tr><tr><td class="name">handle</td><td><code class="type">Function</code></td><td class="desc">事件回调</td><td><em class="optional"></em></td></tr><tr><td class="name">[context]</td><td><code class="type">*</code></td><td class="desc">handle的this对象</td><td><em class="optional"></em></td></tr><tr><td> <b>return </b></td><td><code class="type">Object</code></td><td class="desc">调用者</td></tr></table><p>监听自身自定义事件，如果不指定context参数，调用者即handle的this对象</p><pre>model.on(<span class="str">'save'</span>, <span class="kwd">function</span>() {<br>  <span class="com">// this.do...</span><br>})</pre><p></p><h2 id="events-once">once</h2><p>与on不同的是事件生命周期只有一次</p><h2 id="events-off">off( [name], [handle] )</h2><table><tr><td class="name">[name]</td><td><code class="type">String</code></td><td class="desc">事件名称</td><td><em class="optional"></em></td></tr><tr><td class="name">[handle]</td><td><code class="type">Function</code></td><td class="desc">事件回调</td><td><em class="optional"></em></td></tr><tr><td> <b>return </b></td><td><code class="type">Object</code></td><td class="desc">调用者</td></tr></table><p>解除事件，也可解除指定的事件</p><pre><span class="com">// 解除所有事件</span><br>model.off()</pre><p></p><h2 id="events-listen">listen</h2><p>与on不同的是监听其他对象</p><pre>view1.listen(model2, <span class="str">'save'</span>, <span class="kwd">function</span>() {<br>  <span class="com">// this.do...</span><br>})</pre><p></p><h2 id="events-listenOnce">listenOnce</h2><p>与once不同的是监听其他对象</p><h2 id="events-trigger">trigger( name, [parameter...] )</h2><table><tr><td class="name">name</td><td><code class="type">String</code></td><td class="desc">事件名称</td><td><em class="optional"></em></td></tr><tr><td class="name">[parameter...]</td><td><code class="type">*...</code></td><td class="desc">事件回调接收的参数</td><td><em class="optional"></em></td></tr><tr><td> <b>return </b></td><td><code class="type">Object</code></td><td class="desc">调用者</td></tr></table><p>触发事件</p><pre>view1.listen(view2, <span class="str">'click'</span>, <span class="kwd">function</span>(id) {<br>  <span class="com">// id: 99</span><br>})<br>view2.trigger(<span class="str">'click'</span>, <span class="num">99</span>)</pre><p></p></section><section id="extend"><h1>extend( attributes )</h1><table><tr><td class="name">attributes</td><td><code class="type">Object</code></td><td class="desc">扩展属性</td><td><em class="optional"></em></td></tr><tr><td> <b>return </b></td><td><code class="type">Function</code></td><td class="desc">子类，子类可以继续被继承</td></tr></table><p>类继承机制</p><pre><span class="kwd">var</span> List <span class="opt">=</span> Trunk.extend({})<br>List.Model <span class="opt">=</span> Trunk.Model.extend({})<br><span class="kwd">var</span> MyList <span class="opt">=</span> List.extend({})<br>MyList.Model <span class="opt">=</span> List.Model.extend({})</pre><p></p></section><section id="Trunk.template"><h1>Trunk.template( str )</h1><table><tr><td class="name">str</td><td><code class="type">String</code></td><td class="desc">模版字符串</td><td><em class="optional"></em></td></tr><tr><td> <b>return </b></td><td><code class="type">Function</code></td><td class="desc">传入数据即可返回渲染后的字符串</td></tr></table><p>基于字符串的模版，转换模版字符串成一个可执行的函数，视图中传入template选择器自动获取、编译</p><pre><span class="kwd">var</span> template <span class="opt">=</span> Trunk.template(<span class="str">'&lt;button>&lt;#- data.content #>&lt;/button>'</span>)<br><span class="in">console</span>.log(template({content: <span class="str">'click me'</span>})) <span class="com">// &lt;button>click me&lt;/button></span></pre><p>语法：&lt;#- 表达式 #&gt;；&lt;# 语句 #&gt;</p><h2 id="Trunk.template-global">global</h2><p><code>String</code></p><p>模版中数据根命名空间，默认'data'，可自定义</p><h2 id="Trunk.template-leftTag">leftTag</h2><p><code>String</code></p><p>模版中左分隔符，默认'&lt;#'，可自定义</p><h2 id="Trunk.template-rightTag">rightTag</h2><p><code>String</code></p><p>模版中右分隔符，默认'#&gt;'，可自定义</p></section></div></main><footer><div class="center"><p>Licensed under MIT license.</p><div><a href="https://github.com/jianghai/trunk" title="GitHub"><i class="iconfont icon-github"></i></a><a href="https://github.com/jianghai/trunk/issues" title="Bug反馈"><i class="iconfont icon-genzongmubiaoguanli"></i></a><a href="mailto:jianghai1007@gmail.com" title="邮箱联系"><i class="iconfont icon-youjian"></i></a><a href="/trunk/tutorial#faq" title="常见问题"><i class="iconfont icon-bangzhu"></i></a></div></div></footer></div><i id="toTop" class="iconfont icon-zuishangbu"></i><script src="/trunk/public/javascript/global.js"></script><script>window.baseDir = '/trunk/'</script></body></html>